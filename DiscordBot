# Discord bot.
import discord
import os
import random
from dotenv import load_dotenv
from discord.ext import commands

# Grab Discord API token from environment file.
load_dotenv()
DISCORD_TOKEN = os.getenv("DISCORD_TOKEN")

# Bot prefix and permissions.
bot = commands.Bot(command_prefix="!", intents=discord.Intents().all())

# Set bot status.
@bot.event
async def on_ready():
        await bot.change_presence(activity=discord.Game(name="in the workshop..."))

# A message interaction function.
@bot.event
async def on_message(message):
        if message.content == "hi" and message.author != bot.user:
                await message.channel.send("Hmm... What the hell do you do?")
        await bot.process_commands(message)

# A testing function, which returns "pong," when prompted with "ping."
@bot.command(
        help="Prints pong back to the channel.",
        brief="Prints pong back to the channel."
)
async def ping(ctx):
        await ctx.channel.send("pong")

# A simon-says function, which echoes the users string.
@bot.command(
        help="Echoes what was said.",
        brief="Echoes what was said."
)
async def simonsays(ctx, *args):
        response = ""
        for arg in args:
                response = response + " " + arg
        await ctx.channel.send(response)

# A D20 rolling function.
@bot.command(
        help="Rolls a 20-sided dice.",
        brief="Rolls a 20-sided dice."
)
async def d20(ctx):
        roll = random.randrange(1,20)
        await ctx.channel.send(roll)

# Error message function.
@bot.event
async def error_response(ctx, error):
        if isinstance(error, commands.errors.CheckFailure):
                await ctx.send('Sorry, pal. Admins only.')

bot.run(DISCORD_TOKEN)
